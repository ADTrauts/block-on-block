// ============================================================================
// AI PROVIDER HISTORICAL TRACKING
// ============================================================================
// Stores daily snapshots of AI provider usage and expense data
// Enables trend analysis, historical reporting, and reduces API calls

model AIProviderUsageSnapshot {
  id          String   @id @default(uuid())
  provider    String   // 'openai' | 'anthropic'
  snapshotDate DateTime // Date of the snapshot (YYYY-MM-DD)
  
  // Usage metrics
  totalTokens     BigInt   @default(0)
  inputTokens     BigInt   @default(0)
  outputTokens    BigInt   @default(0)
  totalRequests   Int      @default(0)
  
  // Cost metrics
  totalCost       Decimal  @default(0) @db.Decimal(10, 4)
  currency        String   @default("USD")
  
  // Model breakdown (stored as JSON for flexibility)
  modelBreakdown  Json     // [{ model: string, tokens: number, requests: number, cost: number }]
  
  // Time series data (hourly breakdown for the day)
  hourlyData      Json?    // [{ hour: number, tokens: number, requests: number, cost: number }]
  
  // Metadata
  syncedAt        DateTime @default(now())
  syncSource      String   @default("scheduled") // 'scheduled' | 'manual' | 'api'
  rawApiResponse  Json?    // Store raw API response for debugging
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@unique([provider, snapshotDate])
  @@index([provider])
  @@index([snapshotDate])
  @@index([provider, snapshotDate])
  @@map("ai_provider_usage_snapshots")
}

model AIProviderExpenseSnapshot {
  id          String   @id @default(uuid())
  provider    String   // 'openai' | 'anthropic'
  period      String   // 'day' | 'week' | 'month' | 'year'
  periodStart DateTime // Start of the period
  periodEnd   DateTime // End of the period
  
  // Expense metrics
  totalCost       Decimal  @default(0) @db.Decimal(10, 4)
  currency        String   @default("USD")
  
  // Breakdown by date (for periods > day)
  dailyBreakdown  Json?    // [{ date: string, cost: number, description: string }]
  
  // Model breakdown
  modelBreakdown  Json?    // [{ model: string, cost: number }]
  
  // Metadata
  syncedAt        DateTime @default(now())
  syncSource      String   @default("scheduled")
  rawApiResponse  Json?    // Store raw API response for debugging
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@unique([provider, period, periodStart])
  @@index([provider])
  @@index([period])
  @@index([periodStart])
  @@index([provider, period, periodStart])
  @@map("ai_provider_expense_snapshots")
}
